<div class="content ">
	<div class="file">
		<div *ngIf="msg==='' && loading && text != '' && textArea" class="spinner"></div>
		<div *ngIf="msg==='' && loading && !textArea " class="spinner1"></div>
		<div *ngIf="isUnkown" class="spinner2"></div>
		<!-- Container to display two Buttom -->
		<div class="d-flex justify-content-between mb-2 buttons">

			<button mat-raised-button [ngClass]="{'clicked': textArea}" style="width: 45%; height:6vh;" class="primary"
				(click)="onSelectTextArea($event)">Saisir un text</button>
			<button mat-raised-button [ngClass]="{'clicked': !textArea}" style="width: 45%; height:6vh;" class="primary"
				(click)="onSelectUploadFile($event)">Charger un fichier</button>
		</div>

		<!-- Container to display Text editor -->
		<div *ngIf="textArea" class="mb-1">
			<div class="textArea">
				<textarea placeholder="Saisir un texte jusqu'à 900000 caractères (plus de 130000 mots)..." [(ngModel)]="text" style="height: 15vh;"
					 rows="4" maxlength="900000" class="rounded">
				</textarea>
			</div>

			<div class="d-flex justify-content-between align-items-center carto">
				<button *ngIf="textArea" (click)="sendToSpacy($event)" mat-raised-button class="primary"
					style="width: 45%; height:5vh" [disabled]="!text ">Cartographier</button>

				<button *ngIf="textArea" (click)="clearText()" mat-raised-button class="danger"
					style="width: 45%;height:5vh">Effacer</button>
			</div>
		</div>

		<!-- Container to displayupload file -->
		<div *ngIf="!textArea" style="cursor: pointer;">
			<label for="fileDropReff" class="dropzone mat-elevation-z8 info" style="cursor: pointer; height:20vh">
				<h5>Cliquez pour téléverser un fichier </h5>
				<img src="assets/icons/upload.png" alt="" class="mb-1">
				<input type="file" accept=".txt,.zip" (change)="sendToSpacy($event)" #myInput class="mt-1"
					id="fileDropReff">
				<h5>(type txt jusqu'à 1000 ko, zip jusqu'à 350 ko)</h5>
				
			</label>
		</div>

		<h4 *ngIf="noRepeatedCities.length === 0 && notFoundRepeatedCities.length === 0 && multiDuplicatedCities.length === 0"
			class="text-center danger rounded my-1 msg">{{msg}}</h4>

		<!-- Container to display List Location -->
		<div class="selects mt-1">
			
			<!-- Container to display found location -->
			<div class="mb-2" *ngIf="noRepeatedCities.length > 0">
				<mat-select placeholder="{{noRepeatedCities.length}} Lieux trouvés dans la BDD :" 
						class="w-100 p-2 white rounded mat-elevation-z8"
						style="height: 4vh;">
						<mat-option *ngFor="let location of noRepeatedCities">
							{{location.city}} - {{location.country}}
						</mat-option>
				</mat-select>
			</div>

			<!-- Container to display unknown location -->
			<div class="mb-2 w-100 d-flex" *ngIf="notFoundRepeatedCities.length > 0">
				<mat-select placeholder="{{notFoundRepeatedCities.length}} Lieux non reconnus dans la BDD :"
					class="col p-2 warning rounded mat-elevation-z8"
					style="height: 4vh;">
					<mat-option *ngFor="let location of notFoundRepeatedCities">
						{{location.city}}
					</mat-option>
				</mat-select>

				<!-- NOMINATIM -->
				<!-- <button 
					*ngIf="notFoundRepeatedCities.length > 0 && auth.isAuthenticated()"
					class="primary rounded  mat-elevation-z4 col p-2" 
					(click)="unkownLocation()">Coordonnées via Nominatim
				</button>-->
			</div>
		</div>


		<!-- Container to display confused location -->
		<div *ngIf="duplicatedCities.length > 0">
			<p class="white mat-elevation-z8 rounded w-100 secondary"
				style="padding: 6px; margin-bottom:5px; font-size:14px; height:4vh">Lieux ambigus :</p>
			<div [ngClass]="{'rounded height2' :textArea, 'rounded height1' :!textArea}" style="height: 35vh;">

				<Div *ngFor="let dups of multiDuplicatedCities; let j=index" style="border-bottom: 2px solid rgb(138, 138, 138);">
					<div *ngFor="let location of dups; let i=index">

						<div class="secondary p-1 my-1 rounded ">
							<input type="radio" name="radio{{j}}" value="{{location.city}}" id="checkbox{{i}}"
								(click)="confirmLocation($event,location.id)">
							<span class="ml-1">
								{{location.city}} - {{location.country}}
							</span>
						</div>
					</div>
				</Div>
			</div>
			<button class="secondary rounded mat-elevation-z4 p-2 mb-1"
				style="border: none; width:100%; height:5vh" 
				
				*ngIf="duplicatedCities.length > 0"
				(click)="displayOnMap()">Afficher sur la carte
			</button>
		</div>

		<button class="light primary rounded mat-elevation-z4 p-2 mb-1"
			style="border: none; width:100%; height:5vh"

			*ngIf="notFoundRepeatedCities.length > 0 || noRepeatedCities.length > 0 || multiDuplicatedCities.length > 0"
			(click)="exportCSV()">Exporter en CSV
		</button>
	</div>

	<div class="map">
		<!-- Container to display MAP -->
		<div class="row" id="map" [ngStyle]="{'height':textArea ? '76vh':'70vh'}">
			<!-- Center Icon -->

			<!-- Afficher le bouton "centrer" en cas de "selecetionner un nom du fichier" -->
			<button (click)="onSelectText(textSelected)" color="light" mat-mini-fab class="center-button"
				*ngIf="onCenter && !textArea && !onFirsteCenter">
				<mat-icon> my_location</mat-icon>
			</button>

			<!-- Afficher le bouton "centrer" en cas de "selecetionner une date du fichier" -->
			<button (click)="onSelectDate(dateSelected)" color="light" mat-mini-fab class="center-button"
				*ngIf="!onCenter && !textArea">
				<mat-icon> my_location</mat-icon>
			</button>


			<!-- Afficher le bouton "centrer" en cas de "Saisir un text" -->
			<button (click)="displayOnMap()" color="light" mat-mini-fab class="center-button" 
				*ngIf="onFirsteCenter && !onCenter">
				<mat-icon> my_location</mat-icon>
			</button>
		</div>

		<!-- Container to display bottom of Map -->
		<div class="row slider d-flex items-align-center" *ngIf="foundCities.length > 0">
			<div class="col mt-1 p-1">
				<!-- Displays file name on button -->
				<div class="row p-1">
					<div class="col-3" *ngIf="listOfText.length > 1">
						<button class="light white rounded mat-elevation-z4" style="border: none;"
							(click)="onSelectALl()">All files</button>
					</div>
					<div *ngIf="listOfText.length > 0" class="col-9">
						<button *ngFor="let item of listOfText" (click)="onSelectText(item.legend)"
							class="m-1 rounded mat-elevation-z4 primary" style="border: none;">
							{{item.legend}}
						</button>
					</div>


				</div>
				<!-- Slider for chronic date -->
				<div *ngIf="listOfText.length > 1" class="mt-2">
					<ngx-slider [(value)]="value" [options]="options" [(ngModel)]="dateSelected"
						(mouseup)="onSelectDate(dateSelected)">

					</ngx-slider>
				</div>
			</div>
		</div>
	</div>
	
</div>
